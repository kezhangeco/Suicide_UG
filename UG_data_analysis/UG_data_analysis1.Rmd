---
title: "Longitudinal models"
author: "Ke Zhang"
date: "January 8, 2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache = TRUE)
library(lme4)
library(ggplot2)
library(GGally)
library(plyr)
library(Matrix)
library(nlme)
library(readxl)
library(reshape2)
library(VIF)
library(numDeriv)
library(MuMIn)
library(HLMdiag)
library(DHARMa)
library(bitops)
library(nloptr)
library(optimx)
library(dfoptim)
library(emmeans)
library(afex)
library(usdm)
library(car)
library(glmulti)
library(rJava)
```

```{r, include=FALSE}
load(file = "/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_all_task_data.csv")
load(file = "/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_demog.xlsx")
load(file = "/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_questionnaire.xlsx")

demoQuestion <- merge(demo, question, on = "ID")
allData <- merge(task, demoQuestion, on = "ID")
allData$totalStake <- allData$PlayerProposedAmount + allData$OpponentProposedAmount

allData <- rename(allData, c("HOUSEHOLD INCOME" = "HouseholdIncome", "HRSD NO SUI" = "HRSD_NO_SUI", "PER CAPITA INCOME" = "IncomePerCapita", "MMSE TOTAL" = "MMSE"))

allData$Fairness_score <- as.factor(allData$Fairness_score)
allData$ID <- as.factor(allData$ID)
allData$AcceptOffer <- as.factor(allData$AcceptOffer)

```

1. The predictor *reappraisalDirection* is used as the time series. Recode 2 time points: 
baseline -> 1
experimental -> 2

Does participants change the acceptance over time from the baseline and the framing conditions?
```{r, echo=FALSE}
allData$framingContext <- NA
allData$framingContext[allData$ReappraisalDirection == "punish"] <- "framing"
allData$framingContext[allData$ReappraisalDirection == "empathy"] <- "framing"
allData$framingContext[allData$ReappraisalDirection == "baseline"] <- "baseline"

# random intercept, null model
m_time_null <- glmer(allData$AcceptOffer ~ framingContext + (1|ID), data = allData, family = binomial)

# random intercept and slope
m_time1 <- glmer(allData$AcceptOffer ~ framingContext + (framingContext|ID), data = allData, family = binomial)

# indepedent random effect
m_time2 <- glmer(allData$AcceptOffer ~ framingContext + (1|ID) + (0 + framingContext|ID))

anova(m_time_null, m_time1, m_time2)
summary(m_time2)
```
The tendency of acceptance changes from baseline to framing context. But it could be due to time series.

2. Separate the framing context, use the *trial number* as the time predictor.
Does the time matter in the tendency of acceptance in the framing trials?
```{r, echo=FALSE}
# in punish and empathy
framingData <- subset(allData, allData$framingContext != "baseline")

# null model
m_framing_null <- glmer(framingData$AcceptOffer ~ 1 + (1|ID), data = framingData, family = binomial)

# random intercept
m_framing_randomInter <- glmer(framingData$AcceptOffer ~ scale(Trial_Number) + (1|ID), data = framingData, family = binomial)

# random intercept and slope
m_framing_time1 <- glmer(framingData$AcceptOffer ~ scale(Trial_Number) + (Trial_Number|ID), data = framingData, family = binomial)

# HLM with indepedent random effects of intercept and slope
m_framing_time2 <- glmer(framingData$AcceptOffer ~ scale(merged_trial) + (1|ID) + (0 + merged_trial|ID), data = framingData, family = binomial)

modellist7(m_framing_null, m_framing_randomInter, m_framing_time1, m_framing_time2)
```
The best fit model in the framing context is:

$$log(accept) = scale(merged\,trial) + (1|ID) + (0 + merged\,trial|ID)$$
This logitudinal model consider a model with uncorrelated random effect between $ID$ and $trial number$. Thus the model has two distinct random effects terms, each of which has $ID$ as the grouping factor:
1. 1|$ID$: intercept only
2. 0 + $trial$: slope only

However, *participants were not significantly influenced by the time (trial number) in the framing only context.*

Does time matter in the tendency of acceptance in the baseline trials?
```{r, echo=FALSE}
baselineData <- subset(allData, allData$framingContext == "baseline")

# null model
m_base_null <- glmer(baselineData$AcceptOffer ~ 1 + (1|ID), data = baselineData, family = binomial)

# random intercept 
m_base_randomInter <- glmer(baselineData$AcceptOffer ~ scale(merged_trial) + (1|ID), data = baselineData, family = binomial)

# random intercept and slope
m_base_time1 <- glmer(baselineData$AcceptOffer ~ scale(merged_trial) + (merged_trial|ID), data = baselineData, family = binomial)

# HLM with indepedent random effect
m_base_time2 <- glmer(baselineData$AcceptOffer ~ scale(merged_trial) + (1|ID) + (0 + merged_trial|ID), data = baselineData, family = binomial)

# comparing models
modellist7(m_base_null, m_base_randomInter, m_base_time1, m_base_time2)
```

The best fit model in the baseline context is:
$$log(accept) = scale(merged\,trial) + (1|ID) + (0 + merged\,trial|ID)$$
This logitudinal model consider a model with uncorrelated random effect.

*Participants were significantly influenced by the time (trial number) in the baseline context.*

Overall, because the participants were affected by time across the baseline condition, but not in the framing conditions, we need to run separate longitudinal models by framing and baseline trials.

## Longitudinal model 1: framing only trials
How punish and empathy influence gamble acceptance?
*Time variable*: Trial number within the framing context (punish vs. empathy)

The global models are:
$$framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT$$
```{r, include=FALSE}
### random intercept, fixed slope (level 1 and 2)
m_long_level12_interceptOnly <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE), na.action = "na.fail")

## With trial number as a predictor
m_long_level12_interceptOnly_T <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + Trial_Number + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE), na.action = "na.fail")

anova(m_long_level12_interceptOnly, m_long_level12_interceptOnly_T)
```

```{r, include=FALSE}
### random intercept, random predictors (trial number)
m_long_level12_1 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_1_T <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + Trial_Number + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_1, m_long_level12_1_T)
```


```{r, include=FALSE}
### independent random intercept, random slope (trial number)
# without Trial_Number
m_long_level12_2 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# with Trial_Number
m_long_level12_2_T <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + scale(Trial_Number) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# without Marriage
m_long_level12_2_M <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + scale(Trial_Number) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

## without Marriage and Trial_Number
m_long_level12_2_M1 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# without Marriage, Trial_Number, HRSD_NO_SUI
## no differ than m_long_level12_2_M1
m_long_level12_2_H <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# without Marriage, Trial_Number, HRSD_NO_SUI, MMSE
# no differ than m_long_level12_2_H
m_long_level12_2_MS <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(EDUCATION) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# without Marriage, Trial_Number, HRSD_NO_SUI, MMSE, totalStake
# significantly worse than m_long_level12_2_MS
m_long_level12_2_S <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(EDUCATION) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# without Marriage, Trial_Number, HRSD_NO_SUI, MMSE, totalStake, income
## no differ than m_long_level12_2_S
m_long_level12_2_I <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + Fairness_score + group4 + scale(PROTECT2AGE) + RACETEXT + GENDERTEXT + scale(EDUCATION) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# without Marriage, Trial_Number, HRSD_NO_SUI, MMSE, totalStake, income, gender 
## significantly worse than m_long_level12_2_I
m_long_level12_2_G <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + Fairness_score + group4 + scale(PROTECT2AGE) + RACETEXT + scale(EDUCATION) + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")


summary(m_long_level12_2)
summary(m_long_level12_2_T)
anova(m_long_level12_2_T,m_long_level12_2_M, m_long_level12_2_M1, m_long_level12_2)
anova(m_long_level12_2_M, m_long_level12_2_M1)
anova(m_long_level12_2_M1, m_long_level12_2_H)
anova(m_long_level12_2_G, m_long_level12_2_I)
```

```{r, include=FALSE}
### fixed intercept, random slope (trial number)
m_long_level12_3 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + scale(Trial_Number) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")
```

## best model fit is:
Compare no interaction models, with different random effects:
1. random intercept, fixed slope $(1|ID)$
2. random intercept and slope $(Trial\,Number|ID)$ 
3. independent random intercept and random slope $(1|ID) + (0 + Trial\,Number|ID)$
4. fixed intercept, random slope $(0 + Trial\, Number|ID)$
```{r, include=FALSE}
## best model comparing random effects:
modellist_noInteraction <- model.sel(m_long_level12_interceptOnly, m_long_level12_1, m_long_level12_1_T, m_long_level12_2, m_long_level12_2_T, m_long_level12_3)

## best model comparing predictors:
modellist3 <- model.sel(m_long_level12_interceptOnly, m_long_level12_1, m_long_level12_2, m_long_level12_3, m_long_level12_2_T, m_long_level12_2_M, m_long_level12_2_M1, m_long_level12_2_H, m_long_level12_2_MS, m_long_level12_2_S, m_long_level12_2_I, m_long_level12_2_G, m_long_level12_interceptOnly_T, m_long_level12_1_T)

print(modellist_noInteraction)
print(modellist3)
```

The best random effect in the no interaction effect models is:
$$ (1|ID) + (0 + Trial_Number|ID)$$

The models with random intercept & random slope is similiar with the model with the model with independent random slope and intercept, hence we will use the parsimonious model with *independent random effect*. The two models are better than random intercept only model and fixed intercept and random slope model.

Explore all combinations of predictors of the best fit model (no interaction models), and list the alternatives by by the size of AICc from the small to large. The best model is selected by *model averaging*.

The summary of all alternative models of the selected global model is:
```{r, echo=FALSE}
m_d_long_level12_2 <- dredge(global.model = m_long_level12_2, rank = "AICc")
print(m_d_long_level12_2)
```

The best fit models are (delta < 2), from the smallest AIC to the largest.
```{r, echo=FALSE}
print(get.models(m_d_long_level12_2, subset = delta < 2))
```

The model with the smallest AIC in the longitudinal framing trials is 
$$logit(accept) = Fairness\,score + GENDERTEXT + group4 +  
    Reappraisal\,Direction + \\scale(totalStake) + (1 | ID) + (0 +  
    Trial_Number | ID)$$
    
```{r, echo=FALSE}
# the smallest AIC
m_d_long_level12_2_1 <- get.models(m_d_long_level12_2,1)[[1]]
summary(m_d_long_level12_2_1)
```

### Model averaging
A single model may not representative, average alternative models estimates:
- Delta AIC < 2:
$$logit(accept) = Fairness\,score + Gender + group4 + Reappraisal\,Direction + total\, stake + education + race + \\MMSE + trial\, number + household\, income + age + HRSD\,NO\,SUI$$
- Delta AIC < 7:
$$delta\,AIC < 2\,model + marriage$$
- Delta AIC < 10:
$$delta\, AIC <2\, model + marriage$$

```{r}
# As a rule of thumb, a ∆ i < 2 suggests substantial evidence for the model
m_d_long_level12_2_avg1 <- model.avg(m_d_long_level12_2, subset = delta < 2)
summary(m_d_long_level12_2_avg1)

# values between 3 and 7 indicate that the model has considerably less support
m_d_long_level12_2_avg2 <- model.avg(m_d_long_level12_2, subset = delta < 7)
summary(m_d_long_level12_2_avg2)

# whereas a ∆ i > 10 indicates that the model is very unlikely (Burnham and Anderson 2002)
m_d_long_level12_2_avg3 <- model.avg(m_d_long_level12_2, subset = delta < 10)
summary(m_d_long_level12_2_avg3)
```

## Models with interaction effect 
The following models are compared with this global model without interaction efffect:
$$logit(accept) = ReappraisalDirection + scale(totalStake) + \\Fairness_score + group4 + scale(PROTECT2AGE) + scale(HRSD\,NO\,SUI) +  \\scale(HouseholdIncome) + RACETEXT + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT$$

### independent random intercept and slope
Interaction effects between groups x predictors
```{r, include=FALSE}
### group x race
#### fixed-effect model matrix is rank deficient so dropping 2 columns / coefficients
m_long_level12_inter1 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * RACETEXT+ scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x income
m_long_level12_inter2 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter3 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_inter2, m_long_level12_inter3)

### group x Fairness_score
m_long_level12_inter4_1 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score * group4 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x education
m_long_level12_inter4 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter5 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x MMSE
m_long_level12_inter6 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x age
m_long_level12_inter7 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(PROTECT2AGE) + scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter7 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(PROTECT2AGE) + scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

# compare with/without interaction effect models
modellist4 <- model.sel(m_long_level12_2, m_long_level12_inter1, m_long_level12_inter2, m_long_level12_inter3, m_long_level12_inter4, m_long_level12_inter4_1, m_long_level12_inter5, m_long_level12_inter6, m_long_level12_inter7)

print(modellist4)

anova(m_long_level12_inter1, m_long_level12_inter2)
anova(m_long_level12_inter1, m_long_level12_inter3)
anova(m_long_level12_inter2, m_long_level12_inter3)
```
Group 4 and group 5 do not make significant difference. The following predictors have significant interaction effect with the group variable compared with the no interaction group:
- race x group4
```{r}
summary(m_long_level12_inter1)
```
- education x group4 
```{r}
summary(m_long_level12_inter4)
```
- age x group4
```{r}
summary(m_long_level12_inter7)
```
- fairness_score x group4
```{r}
summary(m_long_level12_inter4_1)
```

### random intercept and fixed slope
```{r, include=FALSE}
### group x race
#### fixed-effect model matrix is rank deficient so dropping 2 columns / coefficients
m_long_level12_inter8 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * RACETEXT+ scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x income
m_long_level12_inter9 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter10 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_inter9, m_long_level12_inter10)

### group x Fairness_score
m_long_level12_inter11 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score * group4 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x education
m_long_level12_inter12 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter13 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_inter12, m_long_level12_inter13)

### group x MMSE
m_long_level12_inter14 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x age
m_long_level12_inter15 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(PROTECT2AGE) + scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_interceptOnly, m_long_level12_inter15)

```
The following predictors has significant interaction effect with the group:
- group x race
- education x group4 and 5
- fairness x group
- age x group4

The independent random slope and intercept models are better than random intercept only model.

### random slope and random intercept
```{r}
### group x race
#### fixed-effect model matrix is rank deficient so dropping 2 columns / coefficients
m_long_level12_inter16 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * RACETEXT+ scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + scale(HouseholdIncome) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x income
m_long_level12_inter17 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter18 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_inter17, m_long_level12_inter18)

### group x Fairness_score
m_long_level12_inter19 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score * group4 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x education
m_long_level12_inter20 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter21 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 * scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_inter20, m_long_level12_inter21)

### group x MMSE
m_long_level12_inter22 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group x age
m_long_level12_inter23 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group4 * scale(PROTECT2AGE) + scale(MMSE) + scale(EDUCATION) + scale(HouseholdIncome) + RACETEXT +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

anova(m_long_level12_inter1, m_long_level12_inter16)
anova(m_long_level12_inter4_1, m_long_level12_inter19)
```
The same interaction effect as above.

## Other 2 way interaction models:
- age x education
- HRSD x income
- Education x income
- gender x income
- race x income
- age x HRSD
- MMSE x education
```{r, include=FALSE}
### age x education
m_long_level12_inter24 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) * scale(EDUCATION) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) +  MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### HRSD x income
m_long_level12_inter25 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) * scale(HouseholdIncome) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### Education x income
m_long_level12_inter26 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + scale(HouseholdIncome) * scale(EDUCATION) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) +  MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### gender x income
m_long_level12_inter27 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT * scale(HouseholdIncome) + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### race x income
m_long_level12_inter28 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + scale(HouseholdIncome) * RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### age x HRSD
m_long_level12_inter29 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) * scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### MMSE x education
m_long_level12_inter30 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + group5 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD_NO_SUI) + GENDERTEXT + scale(MMSE) * scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")
```

### Compare interaction effect models with different random effects:
The 2 way interaction model list is:
```{r, echo=FALSE}
modellist5 <- model.sel(m_long_level12_2, m_long_level12_inter1, m_long_level12_inter2, m_long_level12_inter3, m_long_level12_inter4_1, m_long_level12_inter4, m_long_level12_inter5, m_long_level12_inter6, m_long_level12_inter8, m_long_level12_inter9, m_long_level12_inter10, m_long_level12_inter11, m_long_level12_inter12, m_long_level12_inter14, m_long_level12_inter15, m_long_level12_inter16, m_long_level12_inter17, m_long_level12_inter19, m_long_level12_inter20, m_long_level12_inter22, m_long_level12_inter23, m_long_level12_inter24, m_long_level12_inter25, m_long_level12_inter26, m_long_level12_inter27, m_long_level12_inter28, m_long_level12_inter29, m_long_level12_inter30)

print(modellist5)
```
The model the independent random effect is the best random effect. Among all 2 way interaction effect models, the *best fit model is $Fairness\, score x group4$*:

$$framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness\,score * group4 + scale(HouseholdIncome) + RACETEXT + scale(PROTECT2AGE) + scale(HRSD\,NO\,SUI) + GENDERTEXT + scale(MMSE) + scale(EDUCATION) + MARITALTEXT + (1|ID) + (0 + Trial_Number|ID)$$

And the 2 way interaction model is better than no-interaction effect model.

## multi-way interaction effect model:
- group4 x scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score: failed to converge at $independent random intercept and random slope$ and $random intercept and random slope$.
- group4 x scale(EDUCATION) x scale(PROTECT2AGE)
- scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score: failed to converge at $random intercept and random slope$.
- group4 x scale(PROTECT2AGE) x fairness_score
- group4 x scale(EDUCATION) x fairness_score: failed to converge at $random intercept and random slope$.
- group4 x [scale(EDUCATION) + scale(PROTECT2AGE) + fairness_score]
- group4 x [scale(EDUCATION) + scale(PROTECT2AGE)]
- group4 x [scale(PROTECT2AGE) + fairness_score]
- group4 x (scale(EDUCATION) + fairness_score)
```{r, include=FALSE}
## random intercept and fixed slope
### group4 x scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score
#### only optimizer = bobyqa
m_long_level12_inter31 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4), optimizer = "bobyqa"), na.action = "na.fail")

### group4 x scale(EDUCATION) x scale(PROTECT2AGE)
m_long_level12_inter32 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + RACETEXT + group4 * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score
#significantly better than the no interaction model
m_long_level12_inter33 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 + Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x scale(PROTECT2AGE) x fairness_score
#### optimizer = bobyqa, optimx.nlminb
m_long_level12_inter34 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score  * scale(PROTECT2AGE) + scale(EDUCATION) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4), optimizer = "bobyqa"), na.action = "na.fail")

### group4 x scale(EDUCATION) x fairness_score
#### optimizer = bobyqa
m_long_level12_inter35 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) + scale(MMSE) + scale(PROTECT2AGE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4), optimizer = "bobyqa"), na.action = "na.fail")

### group4 x [scale(EDUCATION) + scale(PROTECT2AGE) + fairness_score]
m_long_level12_inter36 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(EDUCATION) + scale(PROTECT2AGE)) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x [scale(EDUCATION) + scale(PROTECT2AGE)]
m_long_level12_inter37 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + RACETEXT + group4 * (scale(EDUCATION) + scale(PROTECT2AGE)) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x [scale(PROTECT2AGE) + fairness_score]
m_long_level12_inter38 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(PROTECT2AGE)) + scale(EDUCATION) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x (scale(EDUCATION) + fairness_score)
m_long_level12_inter39 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(EDUCATION)) + scale(MMSE) + scale(PROTECT2AGE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter31 <- all_fit(m_long_level12_inter31)
m_long_level12_inter34 <- all_fit(m_long_level12_inter34)
m_long_level12_inter35 <- all_fit(m_long_level12_inter35)
print(m_long_level12_inter34)
```


```{r, include=FALSE}
## (independent random intercept and random slope)
### group4 x scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score
### failed to converge at all optimizers
m_long_level12_inter311 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x scale(EDUCATION) x scale(PROTECT2AGE)
m_long_level12_inter322 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + RACETEXT + group4 * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score
#significantly better than the no interaction model
m_long_level12_inter333 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 + Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")
summary(m_long_level12_inter333)


### group4 x scale(PROTECT2AGE) x fairness_score
m_long_level12_inter344 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score  * scale(PROTECT2AGE) + scale(EDUCATION) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), control = lmerControl(optimizer = "optimx.nlminb"), na.action = "na.fail")

### group4 x scale(EDUCATION) x fairness_score
m_long_level12_inter355 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) + scale(MMSE) + scale(PROTECT2AGE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), control = lmerControl(optimizer = "optimx.nlminb"), na.action = "na.fail")

### group4 x [scale(EDUCATION) + scale(PROTECT2AGE) + fairness_score]
#### optimizer = optimx.nlminb
m_long_level12_inter366 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(EDUCATION) + scale(PROTECT2AGE)) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4), optimizer = "optimx.nlminb"), na.action = "na.fail")
m_long_level12_inter366 <- all_fit(m_long_level12_inter366)


### group4 x [scale(EDUCATION) + scale(PROTECT2AGE)]
m_long_level12_inter377 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + RACETEXT + group4 * (scale(EDUCATION) + scale(PROTECT2AGE)) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x [scale(PROTECT2AGE) + fairness_score]
m_long_level12_inter388 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(PROTECT2AGE)) + scale(EDUCATION) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x (scale(EDUCATION) + fairness_score)
m_long_level12_inter399 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(EDUCATION)) + scale(MMSE) + scale(PROTECT2AGE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

```

```{r, include=FALSE}
## (random intercept and random slope)
### group4 x scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score
#### failed to converge
m_long_level12_inter3111 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x scale(EDUCATION) x scale(PROTECT2AGE)
m_long_level12_inter3222 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + RACETEXT + group4 * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### scale(EDUCATION) x scale(PROTECT2AGE) x fairness_score
#significantly better than the no interaction model
m_long_level12_inter3333 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 + Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x scale(PROTECT2AGE) x fairness_score
#### failed to converge
m_long_level12_inter3444 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score  * scale(PROTECT2AGE) + scale(EDUCATION) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x scale(EDUCATION) x fairness_score
#### failed to converge 
m_long_level12_inter3555 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) + scale(MMSE) + scale(PROTECT2AGE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4, "optimx.nlminb")), na.action = "na.fail")

### group4 x [scale(EDUCATION) + scale(PROTECT2AGE) + fairness_score]
m_long_level12_inter3666 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(EDUCATION) + scale(PROTECT2AGE)) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")
print(m_long_level12_inter3666)

### group4 x [scale(EDUCATION) + scale(PROTECT2AGE)]
m_long_level12_inter3777 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + Fairness_score + RACETEXT + group4 * (scale(EDUCATION) + scale(PROTECT2AGE)) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x [scale(PROTECT2AGE) + fairness_score]
m_long_level12_inter3888 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(PROTECT2AGE)) + scale(EDUCATION) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

### group4 x (scale(EDUCATION) + fairness_score)
m_long_level12_inter3999 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * (Fairness_score + scale(EDUCATION)) + scale(MMSE) + scale(PROTECT2AGE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")
```


```{r, include=FALSE}
## only optimizer = optimx.nlminb
m_long_level12_inter344 <- all_fit(m_long_level12_inter344)

## only optimizer = optimx.nlminb
m_long_level12_inter355 <- all_fit(m_long_level12_inter355)

### 4 way interaction effect in (1|ID)
#### only optimizer = bobyqa
m_long_level12_inter31 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter31 <- all_fit(m_long_level12_inter31)

### 4 way interaction effect in independent random effect
### failed to converge at all optimizer
m_long_level12_inter311 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)+ (0 + Trial_Number|ID), data = framingData, family = binomial, control = glmerControl(calc.derivs = FALSE, optCtrl = list(maxfun = 2e4)), na.action = "na.fail")

m_long_level12_inter311 <- all_fit(m_long_level12_inter311)

```

### all interaction models vs. the no interaction model (m_long_level12_2)
```{r}
modellist1 <- model.sel(m_long_level12_2, m_long_level12_inter2, m_long_level12_inter4_1, m_long_level12_inter4, m_long_level12_inter6, m_long_level12_inter7, m_long_level12_inter9, m_long_level12_inter11, m_long_level12_inter12, m_long_level12_inter14, m_long_level12_inter15, m_long_level12_inter17, m_long_level12_inter19, m_long_level12_inter20, m_long_level12_inter22, m_long_level12_inter23, m_long_level12_inter31$bobyqa., m_long_level12_inter32, m_long_level12_inter33, m_long_level12_inter34$bobyqa., m_long_level12_inter35$bobyqa., m_long_level12_inter36, m_long_level12_inter37, m_long_level12_inter38, m_long_level12_inter39, m_long_level12_inter322, m_long_level12_inter333, m_long_level12_inter344$optimx.nlminb, m_long_level12_inter355$optimx.nlminb, m_long_level12_inter366$optimx.nlminb, m_long_level12_inter377, m_long_level12_inter388, m_long_level12_inter399, m_long_level12_inter16, m_long_level12_inter1, m_long_level12_inter2, m_long_level12_inter3, m_long_level12_inter4_1, m_long_level12_inter4, m_long_level12_inter5, m_long_level12_inter6, m_long_level12_inter8, m_long_level12_inter9, m_long_level12_inter10, m_long_level12_inter11, m_long_level12_inter12, m_long_level12_inter14, m_long_level12_inter15, m_long_level12_inter16, m_long_level12_inter17, m_long_level12_inter19, m_long_level12_inter20, m_long_level12_inter22, m_long_level12_inter23, m_long_level12_inter24, m_long_level12_inter25, m_long_level12_inter26, m_long_level12_inter27, m_long_level12_inter28, m_long_level12_inter29, m_long_level12_inter30, m_long_level12_inter3222, m_long_level12_inter3333, m_long_level12_inter3666, m_long_level12_inter3777, m_long_level12_inter3888, m_long_level12_inter3999)

# summary table of the alternatives
print(modellist1)

# Get models with delta < 10:
print(get.models(modellist1, subset = delta < 10))

# the best fit model:
summary(m_long_level12_inter31$bobyqa.)
```

The best model is a 4-way interaction model*$group4 x Fairness_score x scale(EDUCATION) x scale(PROTECT2AGE)$*

$$m_long_level12_inter31 <- glmer(framingData$AcceptOffer ~ ReappraisalDirection + scale(totalStake) + RACETEXT + group4 * Fairness_score * scale(EDUCATION) * scale(PROTECT2AGE) + scale(MMSE) + scale(HouseholdIncome) +  scale(HRSD_NO_SUI) + GENDERTEXT +  MARITALTEXT + (1|ID)$$

