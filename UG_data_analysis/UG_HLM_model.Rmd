---
title: "UG_HLM"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
# is fairness ratio orthogonal with stake size?

task <- read.csv("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_all_task_data.csv")
task$totalStake <- task$PlayerProposedAmount + task$OpponentProposedAmount
corr <- cor(task$Fairness_score, task$PlayerProposedAmount)
corr1 <- cor(task$Fairness_score, task$OpponentProposedAmount)
corr2 <- cor(task$Fairness_score, task$totalStake)
print(corr)
print(corr1)
print(corr2)
```

```{r}
# demographics and questionnaires plots on distribution and correlations between predictors
# describe predictors by clinical groups
# DRS and Household income: r = 0.398, HRSD NO SUI & age = -0.25, HRSD NO SUI & Household income = r = -0.27

library(lme4)
library(readxl)
library(ggplot2)
task <- read.csv("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_all_task_data.csv")
demo <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_demog.xlsx")
question <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_questionnaire.xlsx")
demoQuestion <- merge(demo, question, on = "ID")

# Continous predictors
ggpairs(demoQuestion[, c("PROTECT2AGE", "HOUSEHOLD INCOME", "HRSD NO SUI", "DRS")])

# by groups
tmp <- melt(demoQuestion[, c("group4", "PROTECT2AGE", "HOUSEHOLD INCOME", "HRSD NO SUI", "DRS")], id.vars = "group4")
tmp1 <- melt(demoQuestion[, c("group5", "PROTECT2AGE", "HOUSEHOLD INCOME", "HRSD NO SUI", "DRS")], id.vars = "group5")

ggplot(tmp, aes(factor(group4), y = value, fill = factor(group4))) +
  geom_boxplot() +
  facet_wrap(~ variable, scales = "free_y")
ggplot(tmp1, aes(factor(group5), y = value, fill = factor(group5))) +
  geom_boxplot() +
  facet_wrap(~ variable, scales = "free_y")

```

```{r}
library(plyr)
# UG models
# random factors: 
task <- read.csv("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_all_task_data.csv")
demo <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_demog.xlsx")
question <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/ug_questionnaire.xlsx")
demoQuestion <- merge(demo, question, on = "ID")
allData <- merge(task, demoQuestion, on = "ID")
allData$totalStake <- allData$PlayerProposedAmount + allData$OpponentProposedAmount
allData <- rename(allData, c("HOUSEHOLD INCOME" = "income", "HRSD NO SUI" = "HRSD_NO_SUI"))

m <- glmer(allData$AcceptOffer ~ ReappraisalDirection + totalStake + Fairness_score + (1|Gender) + (1|income) + (1|HRSD_NO_SUI) + (1|PROTECT2AGE) + (1|group4), data = allData, family = binomial)
print(summary(m))

m1 <- glmer(allData$AcceptOffer ~ ReappraisalDirection + totalStake + Fairness_score + Gender + DRS + income + HRSD_NO_SUI + PROTECT2AGE + group4 + (1|ID), data = allData, family = binomial)
print(summary(m1))
```

```{r}
library(ggplot2)
library(GGally)

hdp <- read.csv("https://stats.idre.ucla.edu/stat/data/hdp.csv")
hdp1 <- within(hdp, {
  Married <- factor(Married, levels = 0:1, labels = c("no", "yes"))
  DID <- factor(DID)
  HID <- factor(HID)
})

ggpairs(hdp[, c("IL6", "CRP", "LengthofStay", "Experience")])

```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
