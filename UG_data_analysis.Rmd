---
title: "UG_data_analysis"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}
#are faired/unfaired offers more/less likely to be accepted than rejected?
#are faired offers more likely to be rejected than unfaired offer?

print("significance of faired offers in accept vs. reject")
print(binom.test(212, 1333+212))

print("significance of unfaired offers in accept vs. reject")
print(binom.test(2481, 4008+2481))

print("significance of faired offer reject vs. unfaired offer reject")
print(binom.test(212, 212+2481))
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
# demograhics ANOVA in 5 levels and 4 levels, are groups different in demographics?
demo <- read.csv("C:\\Users\\ke\\ownCloud\\Suicide_UG\\UG_clean_data\\ug_demos.csv")

# ANOVA in 5 levels, where attempters are HH and LL separately
baselineAge <- aov(demo$BASELINEAGE~demo$group)
consentAge <- aov(demo$PROTECT2AGE, demo$group)
suicideAge <- aov(demo$SUICIDEAGE, demo$group)
maxlethal <- aov(demo$MAXLETHALITY, demo$group)

print("baseline age")
summary(baselineAge)
print("consent age")
summary(consentAge)
print("suicide age")
summary(suicideAge)
print("max lethality")
summary(maxlethal)


demo["baseline_age"] <- NA
demo$baseline_age[demo$group4 == "attempter"] <- "A"
demo$baseline_age[demo$group4 == "control"] <- "C"
demo$baseline_age[demo$group4 == "depression"] <- "D"
demo$baseline_age[demo$group4 == "ideator"] <- "I"



baselineAge <- aov(demo$BASELINEAGE~demo$baseline_age)
consentAge <- aov(demo$PROTECT2AGE, demo$abbr)
suicideAge <- aov(demo$SUICIDEAGE, demo$abbr)
maxlethal <- aov(demo$MAXLETHALITY, demo$abbr)

print("baseline age")
summary(baselineAge)
print("consent age")
summary(consentAge)
print("suicide age")
summary(suicideAge)
print("max lethality")
summary(maxlethal)


baselineAge_hsd <- TukeyHSD(baselineAge)
plot(baselineAge_hsd)
baselineAge_hsd

```


```{r}
library(TeachingDemos)
library(readxl)

# significance test on if each group are significantly different in accepting fair/unfair offer.
?prop.test

###five levels
groups5_fair <- matrix(
  c(45, 44, 50, 42, 31, 210, 256, 310, 303, 254),
  nrow = 5, ncol=2, dimnames = list(c("AttHL", "AttLL", "Control", "Depression", "ideator"), c("reject_fair", "accept_fair")))


groups5_unfair <- matrix(
  c(463, 550, 584, 456, 428, 608, 710, 928, 993, 769),
  nrow = 5, ncol=2, dimnames = list(c("AttHL", "AttLL", "Control", "Depression", "ideator"), c("reject_unfair", "accept_unfair")))

groups5_fair_p <- matrix(
  c(0.82, 0.85, 0.86, 0.88, 0.89, 0.18, 0.15, 0.14, 0.12, 0.11),
  nrow = 5, ncol=2, dimnames = list(c("AttHL", "AttLL", "Control", "Depression", "ideator"), c("reject_fair", "accept_fair")))


groups5_unfair_p <- matrix(
  c(0.57, 0.56, 0.61, 0.69, 0.64, 0.43, 0.44, 0.39, 0.31, 0.36),
  nrow = 5, ncol=2, dimnames = list(c("AttHL", "AttLL", "Control", "Depression", "ideator"), c("reject_unfair", "accept_unfair")))

###four levels
groups4_fair <- matrix(
  c(89, 50, 42, 31, 466, 310, 303, 254),
  nrow = 4, ncol=2, dimnames = list(c("Att", "Control", "Depression", "ideator"), c("reject_fair", "accept_fair")))


groups4_unfair <- matrix(
  c(1013, 584, 456, 428, 1318, 928, 993, 769),
  nrow = 4, ncol=2, dimnames = list(c("Att", "Control", "Depression", "ideator"), c("reject_unfair", "accept_unfair")))


groups4_fair_p <- matrix(
  c(0.84, 0.86, 0.88, 0.89, 0.16, 0.14, 0.12, 0.11),
  nrow = 4, ncol=2, dimnames = list(c("Att", "Control", "Depression", "ideator"), c("reject_fair", "accept_fair")))


groups4_unfair_p <- matrix(
  c(0.57, 0.61, 0.69, 0.64, 0.43, 0.39, 0.31, 0.36),
  nrow = 4, ncol=2, dimnames = list(c("Att", "Control", "Depression", "ideator"), c("reject_unfair", "accept_unfair")))



?Map
b_group5_fair <- Map(binom.test, groups5_fair[, "accept_fair"], rowSums(groups5_fair))
b_group5_unfair <- Map(binom.test, groups5_unfair[, "accept_unfair"], rowSums(groups5_unfair))
b_group4_fair <- Map(binom.test, groups4_fair[, "accept_fair"], rowSums(groups4_fair))
b_group4_unfair <- Map(binom.test, groups4_unfair[, "accept_unfair"], rowSums(groups4_unfair))

print("fair")
print(groups5_fair)
print(groups5_fair_p)
print(b_group5_fair)

print("unfair")
print(groups5_unfair)
print(groups5_unfair_p)
print(b_group5_unfair)

print("fair")
print(groups4_fair)
print(groups4_fair_p)
print(b_group4_fair)

print("unfair")
print(groups4_unfair)
print(groups4_unfair_p)
print(b_group4_unfair)

### if one group is signiifcantly different in accepting fair/unfair offer
?chisq.test
print("chisq on accepting fair across groups")
print(chisq.test(groups5_fair[, "accept_fair"]))

print("chisq on accepting unfair across groups")
print(chisq.test(groups5_unfair[, "accept_unfair"]))

print("chisq on accepting fair across groups")
print(chisq.test(groups4_fair[, "accept_offer"]))

print("chisq on accepting unfair across groups")
print(chisq.test(groups4_unfair[, "accept_unfair"]))

# 3-way ANOVA
group5 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_data/group5_condition_offer.xlsx", sheet = "Sheet2")
Y <- scan()
a1= anova(lm(group5$Accept~group5$fairness*group5$ReappraisalDirection*group5$group5))
summary(a1)
```

```{r}
library(readxl)
# three way anova
x <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_data/group4_condition_offer.xlsx", sheet = "percentage", range = "A1:D25")

df <- read.csv("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_data/all_data.csv")

print(aov(df$AcceptOffer~df$group4*df$ReappraisalDirection&df$fairness))

fair <- c(0.96, 0.63, 0.93, 0.96, 0.68, 0.94, 0.97, 0.72, 0.93, 0.99, )
```

```{r}
# chisquare for basline condition fairness x group
library(readxl)

baseline_group4 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/chisquare_crosstab.xlsx", sheet = "baseline_group4_percent")
baseline_group5 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/chisquare_crosstab.xlsx", sheet = "baseline_group5_percent")

print("4 groups in baseline")
group4 <- xtabs(baseline_group4$accept~baseline_group4$group4 + baseline_group4$fairness)
print(group4)
print(chisq.test(group4))

print("5 groups in baseline")
group5 <- xtabs(baseline_group5$accept~baseline_group5$group5 + baseline_group5$fairness)
print(group5)
print(chisq.test(group5))

```

```{r}
# experimental conditions
# 3 way chisquare fairness x reappraisal x group

group4 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/chisquare_crosstab.xlsx", sheet = "group4_3way_percent")
group5 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/chisquare_crosstab.xlsx", sheet = "group5_3way_percent")

group4_count <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/chisquare_crosstab.xlsx", sheet = "group4_3way_count")
group5_count <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/chisquare_crosstab.xlsx", sheet = "group5_3way_count")


print("4 groups three way chi-square")
group4_3way <- xtabs(group4$accept~group4$group4 + group4$ReappraisalDirection + group4$fairness)
print(group4_3way)
ftable(group4_3way)
print(summary(xtabs(group4$accept~group4$group4 + group4$fairness + group4$ReappraisalDirection)))

print("5 groups three way chi-square")
group5_3way <- xtabs(group5$accept~group5$group5 + group5$ReappraisalDirection + group5$fairness)
print(group5_3way)
ftable(group5_3way)
print(summary(xtabs(group5$accept~group5$group5 + group5$fairness + group5$ReappraisalDirection)))

print("4 groups fair x group")
m <- matrix(
  c(78.33, 56.02, 81.25, 63.69, 83.04, 67.70, 83.5, 65.83),
  nrow = 2, ncol = 4, dimnames = list(
    c("fair", "unfair"), c("attempter", "control", "depression", "ideator")
  )
)
print(m)
print(chisq.test(m))

print("4 groups reappraisal x group")
m <- matrix(
  c(81.41, 39.21, 88.62, 45.51, 84.78, 56.52, 91.91, 46.54), 
  nrow = 2, ncol = 4, dimnames = list(
  c("empathy", "punish"), c("attempter", "control", "depression", "ideator")))
print(m)
print(chisq.test(m))

print("5 groups fair x group")
m <- matrix(
  c(76.47, 57.28, 80, 54.89, 81.25, 63.69, 83.04, 67.7, 83.5, 65.83), 
  nrow = 2, ncol = 5, dimnames = list(
  c("fair", "unfair"), c("attempterHL", "attempterLL", "control", "depression", "ideator")))
print(m)
print(chisq.test(m))

print("5 groups reappraisal x group")
m <- matrix(
  c(84.61, 37.33, 78.54, 40.89, 88.62, 45.51, 84.78, 56.52, 91.92, 46.54), 
  nrow = 2, ncol = 5, dimnames = list(
  c("empathy", "punish"), c("attempterHL", "attempterLL", "control", "depression", "ideator")))
print(m)
print(chisq.test(m))

print("reappraisal x fairness")
m <- matrix(
  c(94.45, 83.82, 67.57, 40.83),
  nrow = 2, ncol = 2, dimnames = list(
    c("fair","unfair"), c("empathy", "punish"))
)
print(m)
print(chisq.test(m))

```
```{r}
# compare baseline and experimental
library(gmodels)

group4 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/fair_reappraisal.xlsx", sheet = "group4_3way")
group5 <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/fair_reappraisal.xlsx", sheet = "group5_3way")

group4_count <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/fair_reappraisal.xlsx", sheet = "group4_reappraisal")
group5_count <- read_excel("/Users/kezhang/ownCloud/Suicide_UG/UG_clean_updated/fair_reappraisal.xlsx", sheet = "group5_reappraisal")

print("3 way chisquare in 4 groups, baseline vs. punish vs. empathy")
group4_3way <- xtabs(group4$accept~group4$group + group4$condition + group4$fairness)
print(group4_3way)
ftable(group4_3way)
print(summary(group4_3way))

print("3 way chisquare in 5 groups, baseline vs. punish vs. empathy")
group5_3way <- xtabs(group5$accept~group5$group + group5$condition + group5$fairness)
print(group5_3way)
ftable(group5_3way)
print(summary(group5_3way))

print("3 way chisquare in 4 groups, baseline vs.framing")
group4_3way <- xtabs(group4$accept~group4$group + group4$condition1 + group4$fairness)
print(group4_3way)
ftable(group4_3way)
print(summary(group4_3way))

print("3 way chisquare in 5 groups, baseline vs.framing")
group5_3way <- xtabs(group5$accept~group5$group + group5$condition1 + group5$fairness)
print(group5_3way)
ftable(group5_3way)
print(summary(group5_3way))

print("2 way chisquare in 4 groups, fairness x group")
m <- matrix(
  c(84.02, 56.53, 86.11, 61.38, 87.83, 68.53, 88.89, 64.06), 
  nrow = 2, ncol = 4, dimnames = list(
  c("fair", "unfair"), c("attempter", "control", "depression", "ideator")))
print(m)
print(chisq.test(m))

print("2 way chisquare in 5 groups, fairness x group")
m <- matrix(
  c(82.35, 56.77, 85.47, 56.33, 86.11, 61.38, 87.83, 68.53, 88.89, 64.06), 
  nrow = 2, ncol = 5, dimnames = list(
  c("fair", "unfair"), c("attempterHL","attempterLL", "control", "depression", "ideator")))
print(m)
print(chisq.test(m))

print("fair x framing")
m <- matrix(
  c(88.89, 61.49, 94.56, 83.82, 67.57, 40.82), 
  nrow = 2, ncol = 3, dimnames = list(
  c("fair", "unfair"), c("baseline", "empathy", "punish")))
print(m)
print(chisq.test(m))

```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
